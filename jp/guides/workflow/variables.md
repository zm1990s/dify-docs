# 変数

**ワークフロー**や**チャットフロー**は、単独ノードで構成されています。多くのノードは入力と出力のアイテムを持っていますが、各ノードの入力および出力情報は一貫性がなく、ダイナミックに変化します。

**固定のシンボルを用いて、ダイナミックなコンテンツをどのように参照するのでしょうか？** 変数はダイナミックなデータコンテナとして、さまざまな内容を格納・送信し、異なるノードの間で相互に参照され、お互いに情報を移動することができます。

### システム変数

システム変数とは、チャットフロー/ワークフロー内でグローバルに使用される事前設定されたシステムレベルのパラメータです。すべてのシステムレベルの変数は`sys.`で始まります。

#### ワークフロー

ワークフローは、以下のシステム変数を提供します：

<!-- | 変数名          | データタイプ  | 説明                                                                           | 注釈                                                                   |
| ------------ | ------- | ---------------------------------------------------------------------------- | -------------------------------------------------------------------- |
| sys.files    | Array[File] | ファイルパラメータで、ユーザーがアプリを初めて使用する際にアップロードした画像を保存します。                                                        | 画像のアップロード機能は、アプリケーションの編成ページ右上の「機能」から開始する必要があります。 |
| sys.user\_id | 文字列     | ユーザー ID: ワークフローを使用する際に、システムによって各ユーザーに自動的に割り当てられる識別番号です。異なるユーザーを区別するために使用される。 |                                                                      | -->

<table>
  <thead>
    <tr>
      <th width="193">変数名</th>
      <th width="116">データタイプ</th>
      <th width="278">说明</th>
      <th>備考</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p><code>sys.files</code></p><p><code>[LEGACY]</code></p></td>
      <td>Array[File]</td>
      <td>ファイルパラメータで、ユーザーがアプリを初めて使用する際にアップロードした画像を保存します。</td>
      <td>画像のアップロード機能は、アプリケーションの編成ページ右上の「機能」から開始する必要があります。</td>
    </tr>
    <tr>
      <td><code>sys.user_id</code></td>
      <td>String</td>
      <td>ユーザーIDです。ワークフローアプリを使用する際、システムが自動的にユーザーに一意の識別子を割り当て、異なるユーザーを区別するために使用します。</td>
      <td></td>
    </tr>
    <tr>
      <td><code>sys.app_id</code></td>
      <td>String</td>
      <td>アプリIDで、システムが各ワークフローアプリに一意の識別子を割り当て、異なるアプリを区別します。このパラメータは現在のアプリの基本情報を記録するために使用されます。</td>
      <td>開発能力を持つユーザー向けで、このパラメータを使用して異なるワークフローアプリを区別し、特定できます。</td>
    </tr>
    <tr>
      <td><code>sys.workflow_id</code></td>
      <td>String</td>
      <td>ワークフローIDで、現在のワークフローアプリに含まれるすべてのノード情報を記録するために使用されます。</td>
      <td>開発能力を持つユーザー向けで、このパラメータを使用してワークフロー内のノード情報を追跡および記録できます。</td>
    </tr>
    <tr>
      <td><code>sys.workflow_run_id</code></td>
      <td>String</td>
      <td>ワークフローアプリ実行IDで、ワークフローアプリ内の実行状況を記録するために使用されます。</td>
      <td>開発能力を持つユーザー向けで、このパラメータを使用してアプリの過去の実行状況を追跡できます。</td>
    </tr>
  </tbody>
</table>

<figure><img src="../../.gitbook/assets/image (30).png" alt=""><figcaption><p>ワークフロー内のシステム変数</p></figcaption></figure>

#### チャットフロー

チャットフローは、以下のシステム変数を提供します：

<table>
  <thead>
    <tr>
      <th>変数名</th>
      <th width="127">データタイプ</th>
      <th width="283">説明</th>
      <th>備考</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>sys.query</code></td>
      <td>String</td>
      <td>ユーザーが最初に入力したダイアログボックスの内容</td>
      <td></td>
    </tr>
    <tr>
      <td><code>sys.files</code></td>
      <td>Array[File]</td>
      <td>ユーザーがダイアログボックス内でアップロードした画像</td>
      <td>画像のアップロード機能は、アプリケーションの構築ページ右上隅の「機能」で有効にする必要があります</td>
    </tr>
    <tr>
      <td><code>sys.dialogue_count</code></td>
      <td>Number</td>
      <td><p>チャットフロー形式のアプリとの対話中にユーザーが持つ対話のラウンド数。各対話の後、自動的に1つのカウントが増加します。if-elseノードと組み合わせて豊富な分岐ロジックを作成できます。</p><p>例えば、Xラウンド目に到達したとき、対話履歴を振り返り分析を提供します。</p></td>
      <td></td>
    </tr>
    <tr>
      <td><code>sys.conversation_id</code></td>
      <td>String</td>
      <td>対話ボックスのインタラクションセッションの一意の識別子で、すべての関連メッセージを同じ対話にグループ化し、LLMが同じトピックとコンテキストに対して持続的な対話を行うことを確認します。</td>
      <td></td>
    </tr>
    <tr>
      <td><code>sys.user_id</code></td>
      <td>String</td>
      <td>各アプリユーザーに割り当てられた一意の識別子で、異なる対話ユーザーを区別するために使用されます。</td>
      <td></td>
    </tr>
    <tr>
      <td><code>sys.app_id</code></td>
      <td>String</td>
      <td>アプリIDで、システムは各ワークフローアプリケーションに一意の識別子を割り当て、異なるアプリを区別し、このパラメータを使用して現在のアプリの基本情報を記録します。</td>
      <td>開発能力を持つユーザー向けで、このパラメータを使用して異なるワークフローアプリを特定および位置付けることができます。</td>
    </tr>
    <tr>
      <td><code>sys.workflow_id</code></td>
      <td>String</td>
      <td>ワークフローIDで、現在のワークフローアプリ内に含まれるすべてのノード情報を記録するために使用されます。</td>
      <td>開発能力を持つユーザー向けで、このパラメータを使用してワークフロー内のすべてのノード情報を追跡および記録できます。</td>
    </tr>
    <tr>
      <td><code>sys.workflow_run_id</code></td>
      <td>String</td>
      <td>ワークフローアプリケーションの実行IDで、ワークフローアプリケーション内の実行状況を記録するために使用されます。</td>
      <td>開発能力を持つユーザー向けで、このパラメータを使用してアプリの過去の実行状況を追跡できます。</td>
    </tr>
  </tbody>
</table>

<figure><img src="../../.gitbook/assets/image (1) (2).png" alt="chatflow app system variables"><figcaption><p>チャットフロー内のシステム変数</p></figcaption></figure>

### 環境変数

**環境変数は、APIキーやデータベースのパスワードといった機密性の高い情報を保護する際に、ワークフロー実行時に活用されます。** これらはコードに直接書き込むのではなく、ワークフローに設定され、異なる環境間での共有が可能になっています。

<figure><img src="../../.gitbook/assets/jp-env-variable.png" alt="Environment Variables"><figcaption><p>環境変数</p></figcaption></figure>

サポートされるデータ型には以下の3つがあります：

* 文字列
* 数値
* シークレット

環境変数は以下の特徴を持ちます：

* 多くのノードでグローバルに参照可能です；
* 同一の環境変数名を複数設定することはできません；
* ノードの出力変数は基本的に読み取り専用で、書き換えることはできません；

***

### 会話変数

> 会話変数は、チャットフローアプリでのみ使用されます。

**ユーザーは会話変数を使っで、チャットフローの会話内で一時的に特定の情報を保存し、同じワークフロー内の複数のチャットにわたってその情報を参照することができます。** 例えば、コンテキスト、チャットボックスにアップロードされたファイル（近々配布予定）、ユーザーが会話中に入力した設定などが含まれます。この機能は、LLM（大規模言語モデル）に「メモ」を提供するようなもので、メモリエラーによる情報のバイアスを回避できます。

<figure><img src="../../.gitbook/assets/conversation-var.png" alt=""><figcaption></figcaption></figure>

以下の6種類のデータ型をサポートしています：

* 文字列
* 数値
* オブジェクト
* 文字列配列
* 数値の配列
* オブジェクトの配列

**会話変数**には次のような特徴があります：

* 会話変数はチャットフロー内のほとんどのノードでグローバルに参照可能です；
* 会話変数にデータを書き込むには、[変数代入](node/variable-assignment.md)ノードを使用する必要があります；
* 会話変数は読み書き可能な変数です；

会話変数と変数代入ノードの具体的な使用方法については、[変数代入](node/variable-assignment.md)をご参照ください。

### 注意事項

* 変数名の重複を避けるため、ノードの命名を繰り返すことはできません。
* ノードの出力変数、通常は固定変数であり、編集できません。
